{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Asset Management{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
  <div>
    <h1 class="page-title">Dashboard</h1>
    <p class="text-gray-500 text-sm">Manage and track your IT assets</p>
  </div>
  <div class="page-actions">
    <a href="{% url 'index' %}" class="btn btn-primary">
      <i class="bi bi-upc-scan"></i>
      Scan Asset
    </a>
  </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon primary">
      <i class="bi bi-laptop"></i>
    </div>
    <div class="stat-value">{{ computer_items|length }}</div>
    <div class="stat-label">Computers</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon success">
      <i class="bi bi-display"></i>
    </div>
    <div class="stat-value" id="monitor-count">-</div>
    <div class="stat-label">Monitors</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon warning">
      <i class="bi bi-printer"></i>
    </div>
    <div class="stat-value" id="printer-count">-</div>
    <div class="stat-label">Printers</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon info">
      <i class="bi bi-hdd-network"></i>
    </div>
    <div class="stat-value" id="dock-count">-</div>
    <div class="stat-label">Docking Stations</div>
  </div>
</div>

<!-- Filter Section -->
<div class="filter-section">
  <div class="filter-toggle" onclick="toggleFilter()">
    <div style="display: flex; align-items: center; gap: var(--space-3);">
      <i class="bi bi-funnel"></i>
      <h3>Filter Computers</h3>
    </div>
    <i class="bi bi-chevron-down" id="filterArrow" style="transition: transform 0.3s;"></i>
  </div>
  <div class="filter-content open" id="filterContent">
    <div class="search-container" style="max-width: 100%;">
      <i class="bi bi-search search-icon"></i>
      <input
        type="text"
        class="search-input"
        id="filterInput"
        placeholder="Search by asset tag, service tag, name, user, make, model..."
        style="padding-left: 2.5rem;"
      />
    </div>
  </div>
</div>

<!-- Quick Actions (Mobile) -->
<div class="hide-desktop mb-6">
  <h3 class="mb-4">Quick Actions</h3>
  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-3);">
    <a href="{% url 'index' %}" class="btn btn-secondary" style="flex-direction: column; padding: var(--space-4);">
      <i class="bi bi-laptop" style="font-size: 1.25rem; margin-bottom: var(--space-1);"></i>
      <span style="font-size: 0.75rem;">Scan Computer</span>
    </a>
    <a href="{% url 'scan_monitor' %}" class="btn btn-secondary" style="flex-direction: column; padding: var(--space-4);">
      <i class="bi bi-display" style="font-size: 1.25rem; margin-bottom: var(--space-1);"></i>
      <span style="font-size: 0.75rem;">Scan Monitor</span>
    </a>
  </div>
</div>

<!-- Asset Grid -->
<div class="asset-grid" id="assetGrid">
  {% for item in computer_items %}
  <div class="asset-card cardd fade-in" style="animation-delay: {{ forloop.counter0|divisibleby:10 }}ms;">
    <a href="{% url 'computers_form' item.id %}" style="text-decoration: none; color: inherit;">
      <div class="asset-card-header">
        <div class="asset-card-tag">
          <i class="bi bi-upc"></i> {{ item.asset_tag }}
        </div>
        <div class="asset-card-title servicetag">{{ item.service_tag|default:"No Service Tag" }}</div>
      </div>
      <div class="asset-card-body">
        <div class="asset-card-row">
          <i class="bi bi-pc-display"></i>
          <span class="asset-card-label">Name</span>
          <span class="asset-card-value computername1">{{ item.computer_name|default:"Not Set" }}</span>
        </div>
        <div class="asset-card-row">
          <i class="bi bi-person"></i>
          <span class="asset-card-label">User</span>
          <span class="asset-card-value user">{{ item.user|default:"Unassigned" }}</span>
        </div>
        <div class="asset-card-row">
          <i class="bi bi-building"></i>
          <span class="asset-card-label">Dept</span>
          <span class="asset-card-value department">{{ item.department|default:"N/A" }}</span>
        </div>
        <div class="asset-card-row">
          <i class="bi bi-cpu"></i>
          <span class="asset-card-label">Specs</span>
          <span class="asset-card-value modelmake" style="font-size: 0.75rem;">{{ item.make }} {{ item.model }}</span>
        </div>
        <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; margin-top: var(--space-2); font-size: 0.7rem; color: var(--gray-500);">
          {% if item.storage %}<span><i class="bi bi-device-hdd"></i> {{ item.storage }}</span>{% endif %}
          {% if item.ram %}<span><i class="bi bi-memory"></i> {{ item.ram }}</span>{% endif %}
          {% if item.cpu %}<span><i class="bi bi-cpu"></i> {{ item.cpu }}</span>{% endif %}
        </div>
      </div>
    </a>
    <div class="asset-card-footer">
      {% if item.printers.all %}
        {% for printer in item.printers.all %}
          <a href="{% url 'printers_page' printer.id %}" class="tag tag-info">
            <i class="bi bi-printer"></i> {{ printer.description|truncatechars:15 }}
          </a>
        {% endfor %}
      {% endif %}
      {% if item.docking_stations.all %}
        {% for dockingstation in item.docking_stations.all %}
          <a href="{% url 'dockingstation_page' dockingstation.id %}" class="tag tag-success">
            <i class="bi bi-hdd-network"></i> Dock
          </a>
        {% endfor %}
      {% endif %}
      {% if item.monitors.all %}
        {% for monitor in item.monitors.all %}
          <a href="{% url 'monitors_page' monitor.id %}" class="tag tag-primary">
            <i class="bi bi-display"></i> Monitor
          </a>
        {% endfor %}
      {% endif %}
      {% if not item.printers.all and not item.docking_stations.all and not item.monitors.all %}
        <span class="tag" style="background: var(--gray-100); color: var(--gray-500);">
          <i class="bi bi-dash"></i> No peripherals
        </span>
      {% endif %}
    </div>
  </div>
  {% empty %}
  <div class="empty-state" style="grid-column: 1 / -1;">
    <div class="empty-state-icon">
      <i class="bi bi-inbox"></i>
    </div>
    <h3 class="empty-state-title">No Computers Found</h3>
    <p class="empty-state-text">Get started by scanning or adding your first computer asset.</p>
    <a href="{% url 'index' %}" class="btn btn-primary">
      <i class="bi bi-plus-lg"></i>
      Add Computer
    </a>
  </div>
  {% endfor %}
</div>

<script>
// Filter functionality
const filterInput = document.getElementById('filterInput');
const assetGrid = document.getElementById('assetGrid');
const cards = document.querySelectorAll('.cardd');

filterInput.addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase();

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    if (text.includes(searchTerm)) {
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
});

// Toggle filter section
function toggleFilter() {
  const filterContent = document.getElementById('filterContent');
  const filterArrow = document.getElementById('filterArrow');
  filterContent.classList.toggle('open');
  filterArrow.style.transform = filterContent.classList.contains('open') ? 'rotate(0)' : 'rotate(-90deg)';
}

// Calculate counts from data
let monitorCount = 0;
let printerCount = 0;
let dockCount = 0;

cards.forEach(card => {
  const monitors = card.querySelectorAll('.tag-primary').length;
  const printers = card.querySelectorAll('.tag-info').length;
  const docks = card.querySelectorAll('.tag-success').length;
  monitorCount += monitors;
  printerCount += printers;
  dockCount += docks;
});

document.getElementById('monitor-count').textContent = monitorCount || '-';
document.getElementById('printer-count').textContent = printerCount || '-';
document.getElementById('dock-count').textContent = dockCount || '-';
</script>
{% endblock content %}
