{% extends 'base.html' %}
{% load static %}

{% block title %}Docking Stations - Asset Management{% endblock %}

{% block header %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">

<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js"></script>

<style>
  table.dataTable thead th {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    font-weight: 600;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 12px 8px;
  }

  table.dataTable tbody td {
    font-size: 0.875rem;
    padding: 12px 8px;
    vertical-align: middle;
  }

  table.dataTable tbody tr:hover {
    background: var(--gray-50) !important;
  }

  .dt-buttons .dt-button {
    background: var(--primary) !important;
    color: white !important;
    border: none !important;
    border-radius: var(--radius) !important;
    padding: 8px 16px !important;
    font-weight: 500 !important;
    margin-right: 8px !important;
  }

  .dt-buttons .dt-button:hover {
    background: var(--primary-dark) !important;
  }

  .dataTables_filter input {
    padding: 8px 12px;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius);
  }

  .dataTables_paginate .paginate_button.current {
    background: var(--primary) !important;
    color: white !important;
    border-color: var(--primary) !important;
  }

  .mobile-card-list { display: none; }

  @media (max-width: 1023px) {
    .desktop-table-view { display: none; }
    .mobile-card-list { display: block; }
  }

  .mobile-asset-card {
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--gray-200);
    margin-bottom: var(--space-4);
    overflow: hidden;
  }

  .mobile-asset-header {
    padding: var(--space-4);
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .mobile-asset-body { padding: var(--space-4); }

  .mobile-asset-row {
    display: flex;
    justify-content: space-between;
    padding: var(--space-2) 0;
    border-bottom: 1px solid var(--gray-100);
    font-size: 0.875rem;
  }

  .mobile-asset-row:last-child { border-bottom: none; }

  .mobile-asset-footer {
    padding: var(--space-3) var(--space-4);
    background: var(--gray-50);
  }
</style>
{% endblock header %}

{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">Docking Stations</h1>
    <p class="text-gray-500 text-sm">View and manage all docking station assets</p>
  </div>
  <div class="page-actions">
    <a href="{% url 'scan_dockingstation' %}" class="btn btn-primary">
      <i class="bi bi-upc-scan"></i>
      Scan Docking Station
    </a>
  </div>
</div>

<!-- Mobile Search -->
<div class="hide-desktop mb-4">
  <div class="search-container" style="max-width: 100%;">
    <i class="bi bi-search search-icon"></i>
    <input type="text" class="search-input" id="mobileSearch" placeholder="Search docking stations..." style="padding-left: 2.5rem;">
  </div>
</div>

<!-- Mobile Card View -->
<div class="mobile-card-list">
  {% for item in dockingstation_items %}
  <a href="{% url 'dockingstation_page' item.id %}" style="text-decoration: none; color: inherit;">
    <div class="mobile-asset-card">
      <div class="mobile-asset-header">
        <div>
          <div style="font-size: 0.75rem; opacity: 0.9;">{{ item.asset_tag }}</div>
          <div style="font-weight: 700;">{{ item.service_tag|default:"No Service Tag" }}</div>
        </div>
        <i class="bi bi-chevron-right"></i>
      </div>
      <div class="mobile-asset-body">
        <div class="mobile-asset-row">
          <span style="color: var(--gray-500);">Make</span>
          <span style="font-weight: 600;">{{ item.make|default:"N/A" }}</span>
        </div>
        <div class="mobile-asset-row">
          <span style="color: var(--gray-500);">Linked Computer</span>
          <span style="font-weight: 600;">
            {% if item.computer %}{{ item.computer }}{% else %}Not linked{% endif %}
          </span>
        </div>
      </div>
      {% if item.computer %}
      <div class="mobile-asset-footer">
        <span class="tag tag-primary"><i class="bi bi-laptop"></i> {{ item.computer }}</span>
      </div>
      {% endif %}
    </div>
  </a>
  {% empty %}
  <div class="empty-state">
    <div class="empty-state-icon"><i class="bi bi-hdd-network"></i></div>
    <h3 class="empty-state-title">No Docking Stations Found</h3>
    <p class="empty-state-text">Add your first docking station by scanning a barcode.</p>
    <a href="{% url 'scan_dockingstation' %}" class="btn btn-primary"><i class="bi bi-plus-lg"></i> Add Docking Station</a>
  </div>
  {% endfor %}
</div>

<!-- Desktop Table View -->
<div class="desktop-table-view">
  <div class="card">
    <div class="card-body" style="overflow-x: auto;">
      <table id="dockingTable" class="display" style="width: 100%;">
        <thead>
          <tr>
            <th>ID</th>
            <th>Asset Tag</th>
            <th>Service Tag</th>
            <th>Make</th>
            <th>Linked Computer</th>
          </tr>
        </thead>
        <tbody>
          {% for item in dockingstation_items %}
          <tr>
            <td>
              <a href="{% url 'dockingstation_page' item.id %}" class="btn btn-primary btn-sm">{{ item.id }}</a>
            </td>
            <td>{{ item.asset_tag }}</td>
            <td><strong>{{ item.service_tag }}</strong></td>
            <td>{{ item.make }}</td>
            <td>
              {% if item.computer %}
                <a href="{% url 'computers_form' item.computer.id %}" class="tag tag-primary">
                  <i class="bi bi-laptop"></i> {{ item.computer }}
                </a>
              {% else %}
                <span class="text-gray-400">Not linked</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
  $('#dockingTable').DataTable({
    responsive: true,
    dom: 'Bfrtip',
    buttons: ['copy', 'excel', 'pdf', 'csv', 'colvis'],
    pageLength: 25,
    order: [[0, 'desc']]
  });

  $('#mobileSearch').on('input', function() {
    const searchTerm = this.value.toLowerCase();
    $('.mobile-asset-card').each(function() {
      const text = $(this).text().toLowerCase();
      $(this).parent().toggle(text.includes(searchTerm));
    });
  });
});
</script>
{% endblock content %}
